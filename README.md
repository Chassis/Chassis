# Chassis

This is the new fangled development environtment base using Vagrant + WordPress 

## Prerequisites

Before using Chassis, this is how your system should be set up:

* Install [VirtualBox 4.3.10](https://www.virtualbox.org/wiki/Downloads)
* Install [Vagrant](http://www.vagrantup.com/downloads.html)
* Zeroconf networking should be set up:

  * **OS X**

    You already have this.

  * **Windows**

    If you have iTunes, Safari, Bonjour Print Services, or Creative Suite 3
    installed, you already have this.

    Otherwise, you need to install Bonjour on your system. The easiest way to
    do this is to [install iTunes][itunes]. If you'd prefer not to do this, you
    can follow [these instructions][bonjour] to install just Bonjour.

  * **Linux**

    You need to have Avahi installed on your system.

    For Ubuntu:

        sudo apt-get install avahi-dnsconfd

  Alternatively, add `vagrant.local` to your hosts file with `192.168.33.10` as
  the IP address.

[itunes]: http://www.apple.com/itunes/download/
[bonjour]: http://help.touch-able.com/kb/network-setup-windows/make-sure-that-bonjour-is-installed-on-your-windows-pc
## Installing Chassis

1. Clone the Chassis repo:

`git clone --recursive git@github.com:Chassis/Chassis.git myproject`

If you forget `--recursive` then run
`git submodule update --init`

2. Install your WordPress project:

* If you have an existing project then:

Clone the content/ directory!
   ```bash
cd myproject
git clone git@github.com:yourcompany/yourproject.git content
   ```

* If you are starting a new project then you will need to create a content folder:

   ```bash
   cd myproject
   mkdir -p content/plugins content/themes
   cp -r wp/wp-content/themes/* content/themes
   ```

Alternatively you can use our Chassis Supercharger as a base

`git clone --recursive git@github.com:Chassis/Supercharger.git content`

3. Boot up a Virtual Machine

`vagrant up`

4. Make a copy of `local-config-sample.php` and rename to `local-config.php`

5. Browse to http://vagrant.local and you should see your site!


## Working with the Virtual Machine

```bash
# Start the VM	
vagrant up

# SSH in to the VM
vagrant ssh

# Reprovisioning (e.g. after updating this repository)
vagrant provision

# Reprovisioning without a full apt-get update
vagrant provision --provision-with puppet

# Updating your hosts file (If there is no IP for vagrant.local)
vagrant up

# Suspending (sleeping) the VM
# Note that this doesn't remove the hosts entry
vagrant suspend

# Halting (shutting down) the VM
vagrant halt

# Destroying the VM (if your VM is completely broken)
vagrant destroy
```

## Configuration
Chassis contains a flexible configuration setup, allowing you flexibility in
overriding the defaults. Chassis follows the following loading procedure:

* `content/config.local.yaml` (project-specific overrides)
* `content/config.yaml` (project-specific defaults)
* `config.local.yaml` (global overrides)
* `config.yaml` (global defaults)

### Multisite
Chassis has full support for running WordPress in multisite mode. Here's what
you need to do to enable it:

1. Add `multisite: Yes` to your `config.local.yaml` or project configuration.
2. Provision your VM!

   (Note: due to [a bug][#32], you need to destroy and recreate an
   already-provisioned VM. We're working on fixing this.)

That's it!

[#32]: https://github.com/Chassis/Chassis/issues/32

### Adding "Real" Domains

We've realized internally that using vagrant.local doesn't always cut it for
development, as you may need to use a different domain for testing. Thankfully
we can fake it 'til we make it by overriding the default configuration.

1. Add your hosts to your YAML configuration. We recommend using your
   project-specific configuration (`content/config.yaml`), since it's part of
   the site's configuration.

   ```yaml
   hosts:
       - vagrant.local
       - example.chassis.com.au
   ```

   (The first host in the list will be used as the machine's name. We recommend
   leaving this as `vagrant.local` for the most part.)

2. Reboot your VM (`vagrant reload`)

### MySQL Database
Your database can be configured completely via the YAML configuration. This is
where the YAML hierarchy is most useful:

* `config.yaml` contains the default (User `wordpress`, password `vagrantpassword`)
* `config.local.yaml` can contain your "real" database details. These can be
  generated by a deployment script, such as Capistrano.

## Updating

```bash
# Pull and rebase (in case you have project-specific commits)
git pull --rebase

## Update submodules (Puppet modules and WP)
git submodule update --init
```


## Update Your Submodules

Sometimes we have to change the submodules because a repository isn't being
regularly maintained. e.g. [Use Puppet Labs's apt module][issue-5].
When this happens you'll probably get confused by submodules so here are the
commands you need to run to get your submodules up to date again.

[issue-5]: https://github.com/Chassis/Chassis/issues/5

```
git submodule sync
cd puppet/modules/apt
git checkout master
git pull

# Ensure your VM is up-to-date
vagrant provision
```
